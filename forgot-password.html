<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>Forgot Password — InzuLink</title>

  <meta name="description" content="Request a password reset link for your InzuLink account." />
  <meta name="robots" content="noindex,follow" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/@phosphor-icons/web" defer></script>

  <link rel="stylesheet" href="./assets/app.css" />

  <style>
    :root{
      --primary:#0f172a;
      --bg:#f8fafc;
      --text:#0b1220;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e2e8f0;
      --shadow: 0 18px 35px rgba(2,6,23,0.10);
      --danger:#dc2626;
      --danger-bg:#fef2f2;
      --success:#16a34a;
      --success-bg:#f0fdf4;
      --warn:#f59e0b;
      --warn-bg:#fffbeb;
    }
    body{ margin:0; font-family:Inter,system-ui,Arial; background:var(--bg); color:var(--text); }
    .wrap{ width:min(720px, 92%); margin:0 auto; padding:18px 0 38px; }
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:22px; box-shadow:var(--shadow);
      padding:26px 22px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      border:1px solid #fde68a; background:#fffbeb; color:#92400e;
      font-weight:900; font-size:.85rem;
    }
    h1{ margin:14px 0 8px; font-size:1.9rem; letter-spacing:-.7px; color:var(--primary); font-weight:900; }
    .sub{ margin:0 0 18px; color:var(--muted); line-height:1.7; font-weight:600; }

    .msg{ display:none; border-radius:14px; padding:12px; font-weight:800; line-height:1.5; border:1px solid var(--border); margin-bottom:12px; }
    .msg.err{ display:block; background:var(--danger-bg); border-color:#fecaca; color:var(--danger); }
    .msg.ok{ display:block; background:var(--success-bg); border-color:#bbf7d0; color:var(--success); }
    .msg.warn{ display:block; background:var(--warn-bg); border-color:#fde68a; color:#92400e; }

    .field{ display:grid; gap:6px; margin-top:10px; }
    label{ font-size:.85rem; font-weight:800; color:#475569; margin:0 0 6px; display:block; }
    .input{
      width:100%; border:1px solid #cbd5e1; border-radius:12px;
      padding:12px; font-size:.98rem; outline:none; background:#fff;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(15,23,42,.10); }

    .hint{ margin-top:10px; color:var(--muted); font-weight:700; font-size:.92rem; line-height:1.6; }

    .btn{
      border:1px solid transparent; border-radius:12px; padding:12px 14px;
      font-weight:900; font-size:1rem; cursor:pointer; user-select:none;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      transition:transform .12s ease, background .12s ease;
      width:100%;
      margin-top:14px;
    }
    .btn:active{ transform:translateY(1px); }
    .btn-primary{ background:var(--primary); color:#fff; }
    .btn-primary:hover{ background:#1e293b; }
    .btn-outline{ background:#fff; border-color:var(--border); color:var(--primary); margin-top:10px; }
    .btn-outline:hover{ background:#f1f5f9; }
  </style>
</head>

<body>
  <div id="appNavbar"></div>

  <main class="wrap">
    <section class="card" aria-label="Forgot password">
      <div class="badge"><i class="ph ph-key"></i> Password Reset</div>
      <h1>Forgot your password?</h1>
      <div class="sub">Enter your email and we’ll send a reset link (or show a demo message if email is disabled).</div>

      <div id="msg" class="msg"></div>

      <form id="fpForm" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input class="input" id="email" type="email" autocomplete="email" placeholder="you@example.com" required />
        </div>

        <div class="hint">
          If you don’t receive a link, check spam. For demos, the server may log the reset link.
        </div>

        <button class="btn btn-primary" id="btnSend" type="submit">
          <i class="ph ph-paper-plane-tilt"></i> Send reset link
        </button>

        <button class="btn btn-outline" type="button" onclick="window.location.href='login.html'">
          <i class="ph ph-sign-in"></i> Back to login
        </button>
      </form>
    </section>
  </main>

  <script src="./assets/navbar.js"></script>
  <script>
    const API_BASE = (localStorage.getItem("API_BASE") || "https://inzulink-v1.onrender.com").replace(/\/$/, "");
    const msg = document.getElementById("msg");
    const btnSend = document.getElementById("btnSend");
    const form = document.getElementById("fpForm");

    function setMsg(type, text){ msg.className = "msg " + type; msg.textContent = text; }
    function clearMsg(){ msg.className = "msg"; msg.textContent = ""; }
    function normalizeEmail(v){ return (v || "").trim().toLowerCase(); }

    async function fetchWithTimeout(url, options = {}, timeoutMs = 12000){
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeoutMs);
      try { return await fetch(url, { ...options, signal: controller.signal }); }
      finally { clearTimeout(id); }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMsg();

      const email = normalizeEmail(document.getElementById("email").value);
      if (!email || !email.includes("@")) return setMsg("err", "Please enter a valid email address.");

      btnSend.disabled = true;
      btnSend.innerHTML = `<i class="ph ph-circle-notch"></i> Sending...`;

      try{
        const res = await fetchWithTimeout(`${API_BASE}/api/auth/forgot-password`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ email })
        });

        let data = {};
        try { data = await res.json(); } catch(_) {}

        if (!res.ok){
          setMsg("err", data.error || "Could not send reset link. Please try again.");
          btnSend.disabled = false;
          btnSend.innerHTML = `<i class="ph ph-paper-plane-tilt"></i> Send reset link`;
          return;
        }

        setMsg("ok", data.message || "If the email exists, a reset link has been sent.");
        btnSend.disabled = false;
        btnSend.innerHTML = `<i class="ph ph-paper-plane-tilt"></i> Send reset link`;

      } catch(err){
        setMsg("warn", "Cannot reach server right now. Please try again.");
        btnSend.disabled = false;
        btnSend.innerHTML = `<i class="ph ph-paper-plane-tilt"></i> Send reset link`;
      }
    });
  </script>
</body>
</html>
