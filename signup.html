<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>Sign Up â€” InzuLink</title>

  <meta name="description" content="Create an InzuLink account to browse listings, save homes, and manage property posts." />
  <meta name="robots" content="index,follow" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/@phosphor-icons/web" defer></script>

  <link rel="stylesheet" href="./assets/app.css" />

  <style>
    :root{
      --primary:#0f172a;
      --bg:#f8fafc;
      --text:#0b1220;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e2e8f0;
      --shadow: 0 18px 35px rgba(2,6,23,0.10);
      --danger:#dc2626;
      --danger-bg:#fef2f2;
      --success:#16a34a;
      --success-bg:#f0fdf4;
      --warn:#f59e0b;
      --warn-bg:#fffbeb;
    }
    body{ margin:0; font-family:Inter,system-ui,Arial; background:var(--bg); color:var(--text); }
    .wrap{ width:min(820px, 92%); margin:0 auto; padding:18px 0 38px; }
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:22px; box-shadow:var(--shadow);
      padding:26px 22px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      border:1px solid #fde68a; background:#fffbeb; color:#92400e;
      font-weight:900; font-size:.85rem;
    }
    h1{ margin:14px 0 8px; font-size:2rem; letter-spacing:-.8px; color:var(--primary); font-weight:900; }
    .sub{ margin:0 0 18px; color:var(--muted); line-height:1.7; font-weight:600; }

    .msg{ display:none; border-radius:14px; padding:12px; font-weight:800; line-height:1.5; border:1px solid var(--border); margin-bottom:12px; }
    .msg.err{ display:block; background:var(--danger-bg); border-color:#fecaca; color:var(--danger); }
    .msg.ok{ display:block; background:var(--success-bg); border-color:#bbf7d0; color:var(--success); }
    .msg.warn{ display:block; background:var(--warn-bg); border-color:#fde68a; color:#92400e; }

    .form{ display:grid; gap:12px; margin-top:10px; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:720px){ .grid2{ grid-template-columns:1fr; } }

    label{ font-size:.85rem; font-weight:800; color:#475569; margin:0 0 6px; display:block; }
    .field{ display:grid; gap:6px; }
    .input, .select{
      width:100%; border:1px solid #cbd5e1; border-radius:12px;
      padding:12px; font-size:.98rem; outline:none; background:#fff;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .input:focus, .select:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(15,23,42,.10); }

    .pw-row{ display:flex; gap:10px; align-items:center; }
    .pw-row .input{ flex:1; }
    .pw-toggle{
      border:1px solid var(--border); background:#fff; color:var(--primary);
      padding:12px; border-radius:12px; cursor:pointer; font-weight:900;
    }
    .pw-toggle:hover{ background:#f1f5f9; }

    .hint{ color:var(--muted); font-weight:700; font-size:.92rem; line-height:1.6; }
    .hint strong{ color:var(--primary); }

    .btn{
      border:1px solid transparent; border-radius:12px; padding:12px 14px;
      font-weight:900; font-size:1rem; cursor:pointer; user-select:none;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      transition:transform .12s ease, background .12s ease;
      width:100%;
    }
    .btn:active{ transform:translateY(1px); }
    .btn-primary{ background:var(--primary); color:#fff; }
    .btn-primary:hover{ background:#1e293b; }
    .btn-outline{ background:#fff; border-color:var(--border); color:var(--primary); }
    .btn-outline:hover{ background:#f1f5f9; }

    .mini{ margin-top:14px; padding:14px; border-radius:16px; border:1px solid #fde68a; background:#fffbeb; color:#92400e; font-weight:800; line-height:1.6; }
    .mini b{ color:#7c2d12; }
  </style>
</head>

<body>
  <div id="appNavbar"></div>

  <main class="wrap">
    <section class="card" aria-label="Signup form">
      <div class="badge"><i class="ph ph-user-plus"></i> Create Account</div>
      <h1>Join InzuLink</h1>
      <div class="sub">Create your account to browse trusted listings, save homes, and manage your dashboard.</div>

      <div id="msg" class="msg"></div>

      <form class="form" id="signupForm" novalidate>
        <div class="field">
          <label for="fullName">Full name</label>
          <input class="input" id="fullName" type="text" placeholder="Your name" required />
        </div>

        <div class="grid2">
          <div class="field">
            <label for="email">Email</label>
            <input class="input" id="email" type="email" autocomplete="email" placeholder="you@example.com" required />
          </div>
          <div class="field">
            <label for="phone">Phone</label>
            <input class="input" id="phone" type="tel" autocomplete="tel" placeholder="+2507..." required />
            <div class="hint">Format: <strong>+2507XXXXXXXX</strong> or <strong>07XXXXXXXX</strong></div>
          </div>
        </div>

        <div class="grid2">
          <div class="field">
            <label for="nida">NIDA number <span style="color:#dc2626;">*</span></label>
            <input class="input" id="nida" type="text" placeholder="Your NIDA number" required />
            <div class="hint">Required for identity verification and fraud prevention.</div>
          </div>
          <div class="field">
            <label for="role">Account type</label>
            <select class="select" id="role">
              <option value="Seeker">Seeker (Find a home)</option>
              <option value="Landlord">Landlord (Post homes)</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label for="password">Password</label>
          <div class="pw-row">
            <input class="input" id="password" type="password" autocomplete="new-password" placeholder="Create a password" required />
            <button class="pw-toggle" type="button" id="pwToggle" aria-label="Show/Hide password">
              <i class="ph ph-eye"></i>
            </button>
          </div>
          <div class="hint">Use at least <strong>8</strong> characters.</div>
        </div>

        <div class="field">
          <label for="confirm">Confirm password</label>
          <input class="input" id="confirm" type="password" autocomplete="new-password" placeholder="Repeat password" required />
        </div>

        <label class="hint" style="display:flex;gap:10px;align-items:flex-start;">
          <input type="checkbox" id="agree" />
          <span>I agree to the Terms and Privacy Policy.</span>
        </label>

        <button class="btn btn-primary" id="btnCreate" type="submit">
          <i class="ph ph-user-plus"></i> Create account
        </button>

        <button class="btn btn-outline" type="button" onclick="window.location.href='login.html'">
          <i class="ph ph-sign-in"></i> I already have an account
        </button>

        <div class="mini">
          <b>Why NIDA?</b> It helps reduce fraud and improves safety for both landlords and seekers.
        </div>
      </form>
    </section>
  </main>

  <script src="./assets/navbar.js"></script>
  <script>
    const API_BASE = (localStorage.getItem("API_BASE") || "https://inzulink-v1.onrender.com").replace(/\/$/, "");
    const msg = document.getElementById("msg");
    const btnCreate = document.getElementById("btnCreate");
    const form = document.getElementById("signupForm");

    function setMsg(type, text){ msg.className = "msg " + type; msg.textContent = text; }
    function clearMsg(){ msg.className = "msg"; msg.textContent = ""; }
    function normalizeEmail(v){ return (v || "").trim().toLowerCase(); }
    function normalizePhone(v){ return (v || "").trim().replace(/\s+/g, ""); }
    function isValidPhone(v){ return /^(\+250|0)?7\d{8}$/.test(normalizePhone(v)); }
    function passwordOk(p){ return p && p.length >= 8; }

    document.getElementById("pwToggle").addEventListener("click", () => {
      const pw = document.getElementById("password");
      pw.type = pw.type === "password" ? "text" : "password";
      document.getElementById("pwToggle").innerHTML =
        pw.type === "password" ? `<i class="ph ph-eye"></i>` : `<i class="ph ph-eye-slash"></i>`;
    });

    async function fetchWithTimeout(url, options = {}, timeoutMs = 12000){
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeoutMs);
      try { return await fetch(url, { ...options, signal: controller.signal }); }
      finally { clearTimeout(id); }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMsg();

      const fullName = (document.getElementById("fullName").value || "").trim();
      const email = normalizeEmail(document.getElementById("email").value);
      const phone = normalizePhone(document.getElementById("phone").value);
      const nida = (document.getElementById("nida").value || "").trim();
      const role = document.getElementById("role").value;
      const password = (document.getElementById("password").value || "").trim();
      const confirm = (document.getElementById("confirm").value || "").trim();
      const agree = document.getElementById("agree").checked;

      if (fullName.length < 2) return setMsg("err", "Please enter your full name.");
      if (!email || !email.includes("@")) return setMsg("err", "Please enter a valid email address.");
      if (!isValidPhone(phone)) return setMsg("err", "Please enter a valid Rwanda phone number.");
      if (!nida || nida.length < 10) return setMsg("err", "Please enter a valid NIDA number.");
      if (!passwordOk(password)) return setMsg("err", "Password must be at least 8 characters.");
      if (password !== confirm) return setMsg("err", "Passwords do not match.");
      if (!agree) return setMsg("warn", "Please accept the Terms and Privacy Policy.");

      btnCreate.disabled = true;
      btnCreate.innerHTML = `<i class="ph ph-circle-notch"></i> Creating account...`;

      try{
        const res = await fetchWithTimeout(`${API_BASE}/api/auth/signup`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ fullName, email, phone, nida, password, role })
        });

        let data = {};
        try { data = await res.json(); } catch(_) {}

        if (!res.ok){
          setMsg("err", data.error || "Signup failed. Please try again.");
          btnCreate.disabled = false;
          btnCreate.innerHTML = `<i class="ph ph-user-plus"></i> Create account`;
          return;
        }

        setMsg("ok", "Account created successfully. Redirecting to login...");
        setTimeout(() => window.location.href = "login.html", 700);

      } catch(err){
        setMsg("warn", "Cannot reach server right now. Please try again.");
        btnCreate.disabled = false;
        btnCreate.innerHTML = `<i class="ph ph-user-plus"></i> Create account`;
      }
    });
  </script>
</body>
</html>
