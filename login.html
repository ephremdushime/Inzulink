<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>Log In â€” InzuLink</title>

  <meta name="description" content="Log in to InzuLink to manage listings, save homes, and access your dashboard." />
  <meta name="robots" content="index,follow" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/@phosphor-icons/web" defer></script>

  <link rel="stylesheet" href="./assets/app.css" />

  <style>
    :root{
      --primary:#0f172a;
      --bg:#f8fafc;
      --text:#0b1220;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e2e8f0;
      --shadow: 0 18px 35px rgba(2,6,23,0.10);
      --danger:#dc2626;
      --danger-bg:#fef2f2;
      --success:#16a34a;
      --success-bg:#f0fdf4;
      --warn:#f59e0b;
      --warn-bg:#fffbeb;
    }
    body{ margin:0; font-family:Inter,system-ui,Arial; background:var(--bg); color:var(--text); }
    .wrap{ width:min(720px, 92%); margin: 0 auto; padding: 18px 0 38px; }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 26px 22px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      border:1px solid #fde68a; background:#fffbeb; color:#92400e;
      font-weight:900; font-size:.85rem;
    }
    h1{ margin:14px 0 8px; font-size:2rem; letter-spacing:-.8px; color:var(--primary); font-weight:900; }
    .sub{ margin:0 0 18px; color:var(--muted); line-height:1.7; font-weight:600; }

    .msg{ display:none; border-radius:14px; padding:12px; font-weight:800; line-height:1.5; border:1px solid var(--border); margin-bottom:12px; }
    .msg.err{ display:block; background:var(--danger-bg); border-color:#fecaca; color:var(--danger); }
    .msg.ok{ display:block; background:var(--success-bg); border-color:#bbf7d0; color:var(--success); }
    .msg.warn{ display:block; background:var(--warn-bg); border-color:#fde68a; color:#92400e; }

    .form{ display:grid; gap:12px; margin-top:10px; }
    label{ font-size:.85rem; font-weight:800; color:#475569; margin:0 0 6px; display:block; }
    .field{ display:grid; gap:6px; }
    .input{
      width:100%; border:1px solid #cbd5e1; border-radius:12px;
      padding:12px; font-size:.98rem; outline:none; background:#fff;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(15,23,42,.10); }
    .row{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-top:4px; }
    .check{ display:flex; align-items:center; gap:8px; color:#334155; font-weight:700; font-size:.92rem; user-select:none; }
    .link{ color:#2563eb; font-weight:900; text-decoration:none; font-size:.92rem; }
    .link:hover{ text-decoration:underline; }

    .btn{
      border:1px solid transparent; border-radius:12px; padding:12px 14px;
      font-weight:900; font-size:1rem; cursor:pointer; user-select:none;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      transition:transform .12s ease, background .12s ease;
    }
    .btn:active{ transform:translateY(1px); }
    .btn-primary{ width:100%; background:var(--primary); color:#fff; }
    .btn-primary:hover{ background:#1e293b; }
    .btn-outline{ width:100%; background:#fff; border-color:var(--border); color:var(--primary); }
    .btn-outline:hover{ background:#f1f5f9; }

    .hint{ margin-top:14px; color:var(--muted); font-weight:700; font-size:.92rem; line-height:1.6; }
    .hint code{ background:#f1f5f9; border:1px solid #e2e8f0; border-radius:10px; padding:6px 8px; display:inline-block; margin-top:8px; }
  </style>

  <script>
    (function () {
      let u = null;
      try { u = JSON.parse(localStorage.getItem("user")); } catch(_) {}
      if (!u) return;
      let dest = "feed.html";
      if (u.role === "Admin") dest = "dashboard.html";
      else if (u.role === "Landlord") dest = "landlord.html";
      else if (u.role === "Seeker") dest = "seeker.html";
      window.location.replace(dest);
    })();
  </script>
</head>

<body>
  <div id="appNavbar"></div>

  <main class="wrap">
    <section class="card" aria-label="Login form">
      <div class="badge"><i class="ph ph-lock-key"></i> Secure Login</div>
      <h1>Welcome back</h1>
      <div class="sub">Log in to manage your account, save homes, and access your dashboard.</div>

      <div id="msg" class="msg"></div>

      <form class="form" id="loginForm" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input class="input" id="email" type="email" autocomplete="email" placeholder="you@example.com" required />
        </div>

        <div class="field">
          <label for="password">Password</label>
          <input class="input" id="password" type="password" autocomplete="current-password" placeholder="Your password" required />
        </div>

        <div class="row">
          <label class="check">
            <input type="checkbox" id="rememberMe" />
            Remember email
          </label>
          <a class="link" href="forgot-password.html">Forgot password?</a>
        </div>

        <button class="btn btn-primary" id="btnLogin" type="submit">
          <i class="ph ph-sign-in"></i> Log In
        </button>

        <button class="btn btn-outline" type="button" onclick="window.location.href='signup.html'">
          <i class="ph ph-user-plus"></i> Create an account
        </button>

        <div class="hint">
          Demo tip: set your backend once:
          <br />
          <code>localStorage.setItem("API_BASE","https://YOUR-BACKEND.onrender.com")</code>
        </div>
      </form>
    </section>
  </main>

  <script src="./assets/navbar.js"></script>
  <script>
    const API_BASE = (localStorage.getItem("API_BASE") || "https://inzulink-v1.onrender.com").replace(/\/$/, "");
    const msg = document.getElementById("msg");
    const btnLogin = document.getElementById("btnLogin");
    const form = document.getElementById("loginForm");

    const savedEmail = localStorage.getItem("remember_email");
    if (savedEmail) {
      document.getElementById("email").value = savedEmail;
      document.getElementById("rememberMe").checked = true;
    }

    function setMsg(type, text){ msg.className = "msg " + type; msg.textContent = text; }
    function clearMsg(){ msg.className = "msg"; msg.textContent = ""; }
    function normalizeEmail(v){ return (v || "").trim().toLowerCase(); }

    function redirectByRole(user){
      const params = new URLSearchParams(window.location.search);
      const next = params.get("next");
      if (next && /^[a-z0-9\-_.\/]+$/i.test(next)) return window.location.replace(next);

      let dest = "feed.html";
      if (user.role === "Admin") dest = "dashboard.html";
      else if (user.role === "Landlord") dest = "landlord.html";
      else if (user.role === "Seeker") dest = "seeker.html";
      window.location.replace(dest);
    }

    async function fetchWithTimeout(url, options = {}, timeoutMs = 9000){
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeoutMs);
      try { return await fetch(url, { ...options, signal: controller.signal }); }
      finally { clearTimeout(id); }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearMsg();

      const email = normalizeEmail(document.getElementById("email").value);
      const password = (document.getElementById("password").value || "").trim();
      const remember = document.getElementById("rememberMe").checked;

      if (!email || !email.includes("@")) return setMsg("err", "Please enter a valid email.");
      if (!password) return setMsg("err", "Please enter your password.");

      if (remember) localStorage.setItem("remember_email", email);
      else localStorage.removeItem("remember_email");

      btnLogin.disabled = true;
      btnLogin.innerHTML = `<i class="ph ph-circle-notch"></i> Logging in...`;

      try {
        const res = await fetchWithTimeout(`${API_BASE}/api/auth/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        let data = {};
        try { data = await res.json(); } catch(_) {}

        if (!res.ok) {
          setMsg("err", data.error || "Login failed. Please check your credentials.");
          btnLogin.disabled = false;
          btnLogin.innerHTML = `<i class="ph ph-sign-in"></i> Log In`;
          return;
        }

        localStorage.setItem("user", JSON.stringify(data.user));
        setMsg("ok", "Login successful. Redirecting...");
        setTimeout(() => redirectByRole(data.user), 450);

      } catch (err) {
        setMsg("warn", "Cannot reach the server right now. Please try again.");
        btnLogin.disabled = false;
        btnLogin.innerHTML = `<i class="ph ph-sign-in"></i> Log In`;
      }
    });
  </script>
</body>
</html>
